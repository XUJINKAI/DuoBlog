{% extends './base.html' %}
{% load crispy_forms_tags %}

{% block title %}Blogs{% endblock %}


{% block css %}
{% endblock %}


{% block content %}
<div class="row">
	<br>
	<ul class="nav nav-tabs" id="nav_site_tab">
		{% for site in sites %}
		<li{% if site_pk == site.pk %} class='active'{% endif %}><a href="{% url 'manage:blogs' site.pk %}">{{ site.domain }}</a></li>
		{% endfor %}
		<form action="{% url 'manage:blog_create' %}" method="POST">
			{% csrf_token %}
			<button type="submit" class="btn btn-default"><p class="fa fa-plus"></p></button>
		</form>
	</ul>
</div>
<br>
<div class="row">
	<div style="max-width: 500px;" class="col-md-8">
	{% crispy form %}
	</div>
	<div style="" class="col-md-4">
		<div style="" class="col-md-2"></div>
		<p>id: {{ blog.pk }}</p>
		<hr>
		<ul>
			<button class="btn btn-danger" onclick="delete_blog({{ site_pk }});">Delete this Blog</button>
		</ul>
	</div>
</div>
{% endblock %}


{% block js %}
<script>
var delete_blog = function(pk){
	if(prompt('This will delete blog {{ blog.name }}, please input your blog domain {{ blog.domain }} to confirm:') == '{{ blog.domain }}') {
		$.ajax({
			url: "{% url 'manage:blog_delete' blog.site.id %}",
			method: 'POST',
			headers: {
				'X-CSRFToken': getCookie('csrftoken'),
			},
			success: function(data){
				window.location = "{% url 'manage:blogs' %}";
			}
		})
	}
}
</script>
{% endblock %}